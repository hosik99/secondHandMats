<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>게시물 작성</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
	<!-- Jquery / Jquery Validateion CDN -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
	<script type="text/javascript">
		/* jquery vaildation */
		$(function() {
			var $fromData = $("#fromData");
			
			//빈칸으로 데이터가 입력되지 않게
			$.validator.addMethod("noSpace",function(value, element){
				return value == '' || value.trim().length !=0
			}, "빈칸으로 입력 할 수 없습니다.");
			
			if($fromData.length){
				$fromData.validate({
					ignore: ".ignore",  //ignore클래스는 유효성 검사를 하지 않음
					
					rules:{
						  title: {
				              required: true,
				              noSpace: true,
				          },
				          location: {
				              required: true,
				              noSpace: true,
				          },
				          contents: {
				              required: true,
				              noSpace: true
				          }
				      },
				      messages:{
				    	  title: {
				              required: '제목을 입력해주세요.',
				              noSpace: '빈칸을 사용하실 수 업습니다.',
				          },
				          location: {
				              required: '거래할 위치를 입력해주세요.',
				              noSpace: '빈칸을 사용하실 수 업습니다.',
				          },
				          contents: {
				              required: '내용을 입력해주세요.',
				              noSpace: '빈칸을 사용하실 수 업습니다.',
				          }
				      },
				    
					/* 유효성 검사를 통과시 전송 */
			      	submitHandler: function (form){
			      		const data = new FormData();
			      		var formData = $('#fromData').serialize();
			      		//var files = $('#files')[0].files[0];
			      		
			      		data.append('post',formData);
			      		//data.append('files',files);
			      		
			      		//alert(files);
						alert(data);
			      		$.ajax({
							url : '/member/post/savePostInfo',
							method:'post', 
							enctype: 'multipart/form-data',
							cache:false,
							contentType: false,
					        processData: false,
							data:data,
							dataType:'json',
							success:function(res){
								location.href="/sign/signUp/success";
							},
							error:function(xhr,status,err){
								alert('문제가 발생했습니다. 재접속 해주세요.');
							}
						});
						return false;
		            },
				})
			}
		})
	</script>
	<style type="text/css">
		.error {color:red; font-style: italic;}
	</style>
</head>
<body>	
	<th:block th:replace="thymeleaf/layout/topLayout :: topLayout">
	   <th:block th:fragment="content"></th:block>
	</th:block>
	
	<form id="fromData">
		  <div class="mb-3 row">
		    <label for="title" class="col-sm-2 col-form-label">제목</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="title" name="title">
		    </div>
		  </div>
		  <div class="mb-3 row">
		    <label for="location" class="col-sm-2 col-form-label">위치</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="location" name="location">
		    </div>
		  </div>
		  <div class="mb-3">
			  <label for="files" class="form-label">사진 (.png / .jpg형식만 가능)</label>
			  <input type="file" class="form-control ignore" id="files" name="files" multiple="multiple">
		  </div>
		  <div class="mb-3">
			  <label for="exampleFormControlTextarea1" class="form-label">내용</label>
			  <textarea class="form-control" rows="3" id="contents" name="contents"></textarea>
		  </div>
		  <input type="submit" th:value="저장">
		  <input type="button" th:value="취소" th:onclick="javascript:window.history.back();">
	</form>
	
</body>
</html>